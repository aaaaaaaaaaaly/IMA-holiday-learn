## 正规方程法初尝试代码实现

```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
```

#### 先处理数据


```python
from sklearn.datasets import load_diabetes
# 从sklearn库数据集里面导入糖尿病数据集
# 糖尿病数据集叫load_diabetes()
```


```python
#数据命名
diabetes=load_diabetes()
diabetes
# 打印观察，发现有data，feature_names，target
```




    {'data': array([[ 0.03807591,  0.05068012,  0.06169621, ..., -0.00259226,
              0.01990842, -0.01764613],
            [-0.00188202, -0.04464164, -0.05147406, ..., -0.03949338,
             -0.06832974, -0.09220405],
            [ 0.08529891,  0.05068012,  0.04445121, ..., -0.00259226,
              0.00286377, -0.02593034],
            ...,
            [ 0.04170844,  0.05068012, -0.01590626, ..., -0.01107952,
             -0.04687948,  0.01549073],
            [-0.04547248, -0.04464164,  0.03906215, ...,  0.02655962,
              0.04452837, -0.02593034],
            [-0.04547248, -0.04464164, -0.0730303 , ..., -0.03949338,
             -0.00421986,  0.00306441]]),
     'target': array([151.,  75., 141., 206., 135.,  97., 138.,  63., 110., 310., 101.,
             69., 179., 185., 118., 171., 166., 144.,  97., 168.,  68.,  49.,
             68., 245., 184., 202., 137.,  85., 131., 283., 129.,  59., 341.,
             87.,  65., 102., 265., 276., 252.,  90., 100.,  55.,  61.,  92.,
            259.,  53., 190., 142.,  75., 142., 155., 225.,  59., 104., 182.,
            128.,  52.,  37., 170., 170.,  61., 144.,  52., 128.,  71., 163.,
            150.,  97., 160., 178.,  48., 270., 202., 111.,  85.,  42., 170.,
            200., 252., 113., 143.,  51.,  52., 210.,  65., 141.,  55., 134.,
             42., 111.,  98., 164.,  48.,  96.,  90., 162., 150., 279.,  92.,
             83., 128., 102., 302., 198.,  95.,  53., 134., 144., 232.,  81.,
            104.,  59., 246., 297., 258., 229., 275., 281., 179., 200., 200.,
            173., 180.,  84., 121., 161.,  99., 109., 115., 268., 274., 158.,
            107.,  83., 103., 272.,  85., 280., 336., 281., 118., 317., 235.,
             60., 174., 259., 178., 128.,  96., 126., 288.,  88., 292.,  71.,
            197., 186.,  25.,  84.,  96., 195.,  53., 217., 172., 131., 214.,
             59.,  70., 220., 268., 152.,  47.,  74., 295., 101., 151., 127.,
            237., 225.,  81., 151., 107.,  64., 138., 185., 265., 101., 137.,
            143., 141.,  79., 292., 178.,  91., 116.,  86., 122.,  72., 129.,
            142.,  90., 158.,  39., 196., 222., 277.,  99., 196., 202., 155.,
             77., 191.,  70.,  73.,  49.,  65., 263., 248., 296., 214., 185.,
             78.,  93., 252., 150.,  77., 208.,  77., 108., 160.,  53., 220.,
            154., 259.,  90., 246., 124.,  67.,  72., 257., 262., 275., 177.,
             71.,  47., 187., 125.,  78.,  51., 258., 215., 303., 243.,  91.,
            150., 310., 153., 346.,  63.,  89.,  50.,  39., 103., 308., 116.,
            145.,  74.,  45., 115., 264.,  87., 202., 127., 182., 241.,  66.,
             94., 283.,  64., 102., 200., 265.,  94., 230., 181., 156., 233.,
             60., 219.,  80.,  68., 332., 248.,  84., 200.,  55.,  85.,  89.,
             31., 129.,  83., 275.,  65., 198., 236., 253., 124.,  44., 172.,
            114., 142., 109., 180., 144., 163., 147.,  97., 220., 190., 109.,
            191., 122., 230., 242., 248., 249., 192., 131., 237.,  78., 135.,
            244., 199., 270., 164.,  72.,  96., 306.,  91., 214.,  95., 216.,
            263., 178., 113., 200., 139., 139.,  88., 148.,  88., 243.,  71.,
             77., 109., 272.,  60.,  54., 221.,  90., 311., 281., 182., 321.,
             58., 262., 206., 233., 242., 123., 167.,  63., 197.,  71., 168.,
            140., 217., 121., 235., 245.,  40.,  52., 104., 132.,  88.,  69.,
            219.,  72., 201., 110.,  51., 277.,  63., 118.,  69., 273., 258.,
             43., 198., 242., 232., 175.,  93., 168., 275., 293., 281.,  72.,
            140., 189., 181., 209., 136., 261., 113., 131., 174., 257.,  55.,
             84.,  42., 146., 212., 233.,  91., 111., 152., 120.,  67., 310.,
             94., 183.,  66., 173.,  72.,  49.,  64.,  48., 178., 104., 132.,
            220.,  57.]),
     'frame': None,
     'DESCR': '.. _diabetes_dataset:\n\nDiabetes dataset\n----------------\n\nTen baseline variables, age, sex, body mass index, average blood\npressure, and six blood serum measurements were obtained for each of n =\n442 diabetes patients, as well as the response of interest, a\nquantitative measure of disease progression one year after baseline.\n\n**Data Set Characteristics:**\n\n  :Number of Instances: 442\n\n  :Number of Attributes: First 10 columns are numeric predictive values\n\n  :Target: Column 11 is a quantitative measure of disease progression one year after baseline\n\n  :Attribute Information:\n      - age     age in years\n      - sex\n      - bmi     body mass index\n      - bp      average blood pressure\n      - s1      tc, T-Cells (a type of white blood cells)\n      - s2      ldl, low-density lipoproteins\n      - s3      hdl, high-density lipoproteins\n      - s4      tch, thyroid stimulating hormone\n      - s5      ltg, lamotrigine\n      - s6      glu, blood sugar level\n\nNote: Each of these 10 feature variables have been mean centered and scaled by the standard deviation times `n_samples` (i.e. the sum of squares of each column totals 1).\n\nSource URL:\nhttps://www4.stat.ncsu.edu/~boos/var.select/diabetes.html\n\nFor more information see:\nBradley Efron, Trevor Hastie, Iain Johnstone and Robert Tibshirani (2004) "Least Angle Regression," Annals of Statistics (with discussion), 407-499.\n(https://web.stanford.edu/~hastie/Papers/LARS/LeastAngle_2002.pdf)',
     'feature_names': ['age',
      'sex',
      'bmi',
      'bp',
      's1',
      's2',
      's3',
      's4',
      's5',
      's6'],
     'data_filename': 'D:\\Users\\Win10\\anaconda3\\lib\\site-packages\\sklearn\\datasets\\data\\diabetes_data.csv.gz',
     'target_filename': 'D:\\Users\\Win10\\anaconda3\\lib\\site-packages\\sklearn\\datasets\\data\\diabetes_target.csv.gz'}




```python
#变量赋值,获取一维数据
data=diabetes['data']
fname=diabetes['feature_names']
target=diabetes['target']
```


```python
#数据合并为表格，查看基本情况
df=pd.DataFrame(data,columns=fname)
df.head()
#df.info()
#info()用于摘要
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>sex</th>
      <th>bmi</th>
      <th>bp</th>
      <th>s1</th>
      <th>s2</th>
      <th>s3</th>
      <th>s4</th>
      <th>s5</th>
      <th>s6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.038076</td>
      <td>0.050680</td>
      <td>0.061696</td>
      <td>0.021872</td>
      <td>-0.044223</td>
      <td>-0.034821</td>
      <td>-0.043401</td>
      <td>-0.002592</td>
      <td>0.019908</td>
      <td>-0.017646</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.001882</td>
      <td>-0.044642</td>
      <td>-0.051474</td>
      <td>-0.026328</td>
      <td>-0.008449</td>
      <td>-0.019163</td>
      <td>0.074412</td>
      <td>-0.039493</td>
      <td>-0.068330</td>
      <td>-0.092204</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.085299</td>
      <td>0.050680</td>
      <td>0.044451</td>
      <td>-0.005671</td>
      <td>-0.045599</td>
      <td>-0.034194</td>
      <td>-0.032356</td>
      <td>-0.002592</td>
      <td>0.002864</td>
      <td>-0.025930</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.089063</td>
      <td>-0.044642</td>
      <td>-0.011595</td>
      <td>-0.036656</td>
      <td>0.012191</td>
      <td>0.024991</td>
      <td>-0.036038</td>
      <td>0.034309</td>
      <td>0.022692</td>
      <td>-0.009362</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.005383</td>
      <td>-0.044642</td>
      <td>-0.036385</td>
      <td>0.021872</td>
      <td>0.003935</td>
      <td>0.015596</td>
      <td>0.008142</td>
      <td>-0.002592</td>
      <td>-0.031991</td>
      <td>-0.046641</td>
    </tr>
  </tbody>
</table>
</div>



### 建立模型

x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.3, random_state=0)

1. x_train:包括所有自变量，这些变量将用于训练模型，同样，我们已经指定测试_size=0.4，这意味着来自完整数据的60%的观察值将用于训练/拟合模型，其余40%将用于测试模型

2. y_train-这是因变量，需要此模型进行预测，其中包括针对自变量的类别标签，我们需要在训练/拟合模型时指定我们的因变量

3. x_test:这是数据中剩余的40%的自变量部分，这些自变量将不会在训练阶段使用，并将用于进行预测，以测试模型的准确性。

4. y_test-此数据具有测试数据的类别标签，这些标签将用于测试实际类别和预测类别之间的准确性。

5. random_state：控制随机状态,固定random_state后，每次构建的模型是相同的、生成的数据集是相同的、每次的拆分结果也是相同的。



```python
# 抽取训练集
from sklearn.model_selection import train_test_split
train_x,test_x,train_y,test_y=train_test_split(data,target,train_size=0.6)

#建立模型
from sklearn.linear_model import LinearRegression
model=LinearRegression()

```

### 基础知识

sklearn可以通过 fit，predict，score来训练，评价模型，最终使用模型进行预测

最小二乘法线性回归：
sklearn.linear_model.LinearRegression(fit_intercept=True, normalize=False,copy_X=True, n_jobs=1)

linear_model是线性模型的意思
.LinearRegression表示线性回归

1.fit_intercept：boolean,optional,default True。是否计算截距，默认为计算。如果使用中心化的数据，可以考虑设置为False,不考虑截距。注意这里是考虑，一般还是要考虑截距。


2.normalize：boolean,optional,default False。标准化开关，默认关闭；该参数在fit_intercept设置为False时自动忽略。如果为True,回归会标准化输入参数：(X-X均值)/||X||，在这里还是建议将标准化的工作放在训练模型之前；若为False，在训练模型前，可sklearn.preprocessing.StandardScaler进行标准化处理。


3.copy_X：boolean,optional,default True。默认为True, 否则X会被改写。


4.n_jobs：int,optional,default 1int。默认为1.当-1时默认使用全部CPUs 



属性：

coef_：array,shape(n_features, ) or (n_targets, n_features)。回归系数(斜率)。
intercept_: 截距



方法：

1、fit(X,y,sample_weight=None)

X:array, 稀疏矩阵 [n_samples,n_features] y:array [n_samples, n_targets] sample_weight:array [n_samples]，每条测试数据的权重，同样以矩阵方式传入

2、predict(x):预测方法，将返回值y_pred

3、get_params(deep=True)： 返回对regressor 的设置值

4、score(X,y,sample_weight=None)：评分函数，将返回一个小于1的得分，可能会小于0


```python
#训练数据
model.fit(train_x,train_y)
LinearRegression(copy_X=True,fit_intercept=True,n_jobs=1,normalize=False)
#模型评估
model.score(train_x,train_y)
```




    0.5191974479469703




```python
#可视化
#线性回归模型要求传入的是二维数据,注意报错有可能是因为你传出的是一维数据,要用reshape修改形状
plt.figure(figsize=(2*6,5*5))
train_x=df.loc[100,df.columns[0]].reshape(-1,1)
#先从第一列开始尝试画图
```


    <Figure size 864x1800 with 0 Axes>


报错：

1.找到样本数不一致的输入变量：[1， 442]

2.unexpected indent：意外缩进

反思：

三大库参数重新复习


```python
#训练模型
train_y=target
linear_model=LinearRegression()
linear_model.fit(train_x,train_y)
#以训练数据画散点图
score=linear_model.score(train_x,train_y)
 axes=plt.subplot(5,2,1800)
plt.scatter(train_x,train_y)
#画出拟合直线
k=linear_model.coef_#回归系数
b=linear_model.intercept_#截距
x=np.linspace(train_x.min(),train_x.max(),100)
y=k*x+b
#画图
plt.plot(x,y,c='green')
axes.set_title(str(score))
plt.show()
```


      File "<ipython-input-63-dd8b65bc27b2>", line 7
        axes=plt.subplot(5,2,1800)
        ^
    IndentationError: unexpected indent




```python

```
